<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>guidebook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="GUIDEBOOK_files/libs/clipboard/clipboard.min.js"></script>
<script src="GUIDEBOOK_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="GUIDEBOOK_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="GUIDEBOOK_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="GUIDEBOOK_files/libs/quarto-html/popper.min.js"></script>
<script src="GUIDEBOOK_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="GUIDEBOOK_files/libs/quarto-html/anchor.min.js"></script>
<link href="GUIDEBOOK_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="GUIDEBOOK_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="GUIDEBOOK_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="GUIDEBOOK_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="GUIDEBOOK_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="leadgen-workflow-guidebook" class="level1">
<h1>LeadGen Workflow Guidebook</h1>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#1-introduction--purpose">Introduction &amp; Purpose</a></li>
<li><a href="#2-complete-workflow-diagram">Complete Workflow Diagram</a></li>
<li><a href="#3-state-management">State Management</a></li>
<li><a href="#4-node-by-node-breakdown">Node-by-Node Breakdown</a></li>
<li><a href="#5-dotdb-subgraph-deep-dive">DotDB Subgraph Deep Dive</a></li>
<li><a href="#6-research-supervisor-integration">Research Supervisor Integration</a></li>
<li><a href="#7-lead-data-structure">Lead Data Structure</a></li>
<li><a href="#8-configuration">Configuration</a></li>
<li><a href="#9-api-clients">API Clients</a></li>
<li><a href="#10-troubleshooting">Troubleshooting</a></li>
</ol>
<hr>
</section>
<section id="introduction-purpose" class="level2">
<h2 class="anchored" data-anchor-id="introduction-purpose">1. Introduction &amp; Purpose</h2>
<section id="what-is-leadgen" class="level3">
<h3 class="anchored" data-anchor-id="what-is-leadgen">What is LeadGen?</h3>
<p>LeadGen is a specialized workflow built on top of the Open Deep Research framework, designed specifically for <strong>domain brokerage lead generation</strong>. It takes a domain name as input and produces a structured list of potential buyers (leads) who might be interested in acquiring that domain.</p>
</section>
<section id="key-objectives" class="level3">
<h3 class="anchored" data-anchor-id="key-objectives">Key Objectives</h3>
<ol type="1">
<li><p><strong>Domain Classification</strong>: Categorize the input domain into one or more business categories (e.g., Generic Keywords, Informational, Category Killer, Geographic, etc.)</p></li>
<li><p><strong>Buyer Persona Generation</strong>: Create tiered buyer personas (Tier 1-4) representing different types of companies that would be interested in the domain</p></li>
<li><p><strong>Dual Lead Generation</strong>: Generate leads through two parallel paths:</p>
<ul>
<li><strong>Web Research</strong>: Uses AI-powered web search to find companies matching buyer personas</li>
<li><strong>DotDB Integration</strong>: Uses keyword-based domain matching via DotDB API</li>
</ul></li>
<li><p><strong>Lead Deduplication</strong>: Merge and deduplicate leads from both sources based on normalized website URLs</p></li>
<li><p><strong>Structured Output</strong>: Return a clean list of leads with detailed summaries, rationales, and metadata</p></li>
</ol>
</section>
<section id="use-cases" class="level3">
<h3 class="anchored" data-anchor-id="use-cases">Use Cases</h3>
<ul>
<li>Domain brokers identifying potential buyers for domains</li>
<li>Domain investors researching market opportunities</li>
<li>Companies looking to acquire relevant domains</li>
<li>Market research for domain valuation</li>
</ul>
<hr>
</section>
</section>
<section id="complete-workflow-diagram" class="level2">
<h2 class="anchored" data-anchor-id="complete-workflow-diagram">2. Complete Workflow Diagram</h2>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                         START                                   │
│                    (domain_name input)                          │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│          classify_and_seed_supervisor                           │
│  • Classify domain into categories                              │
│  • Generate tiered buyer personas                               │
│  • Seed supervisor with classification output                   │
│  • Initialize research_brief                                    │
└────────────┬───────────────────────────────┬────────────────────┘
             │                               │
             │                               │
             ▼                               ▼
┌───────────────────────────┐   ┌──────────────────────────────┐
│   research_supervisor     │   │   dotdb_generate_leads       │
│   (Supervisor Subgraph)   │   │   (DotDB Subgraph)           │
│                           │   │                              │
│  • Delegates research     │   │  • Generate keywords         │
│    tasks to researchers   │   │  • Fetch domains from DotDB  │
│  • Finds companies        │   │  • Validate via Jina API     │
│    matching personas      │   │  • Extract leads from sites  │
│  • Extracts leads from    │   │                              │
│    research results       │   │                              │
└────────────┬──────────────┘   └──────────────┬───────────────┘
             │                                 │
             │                                 │
             └───────────┬─────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    dedupe_leads                                 │
│  • Normalize website URLs using tldextract                      │
│  • Deduplicate based on normalized domains                      │
│  • Keep leads with more information when duplicates found       │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                      get_leads                                  │
│  • Final deduplication pass                                     │
│  • Convert dict leads to Lead objects                           │
│  • Return clean, structured lead list                           │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                          END                                    │
│              (Final leads list output)                          │
└─────────────────────────────────────────────────────────────────┘</code></pre>
<section id="parallel-execution" class="level3">
<h3 class="anchored" data-anchor-id="parallel-execution">Parallel Execution</h3>
<p>The workflow executes two paths in parallel after classification:</p>
<ol type="1">
<li><strong>Research Supervisor Path</strong>: Uses AI-powered web research to find companies</li>
<li><strong>DotDB Path</strong>: Uses keyword-based domain matching</li>
</ol>
<p>Both paths converge at <code>dedupe_leads</code> where results are merged and deduplicated.</p>
<hr>
</section>
</section>
<section id="state-management" class="level2">
<h2 class="anchored" data-anchor-id="state-management">3. State Management</h2>
<section id="leadgenstate-structure" class="level3">
<h3 class="anchored" data-anchor-id="leadgenstate-structure">LeadGenState Structure</h3>
<p>The main state for the LeadGen workflow is defined in <code>src/lead_gen/agent.py</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LeadGenState(TypedDict, total<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inputs</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    domain_name: <span class="bu">str</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Intermediate</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    classification_output: <span class="bu">str</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Supervisor context</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    supervisor_messages: Annotated[<span class="bu">list</span>[MessageLikeRepresentation], override_reducer]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    research_brief: <span class="bu">str</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Research artifacts</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    notes: Annotated[<span class="bu">list</span>[<span class="bu">str</span>], override_reducer]</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final structured leads</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    leads: Annotated[<span class="bu">list</span>[<span class="st">"Lead"</span>], override_reducer]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Location</strong>: <code>src/lead_gen/agent.py:41-53</code></p>
</section>
<section id="state-fields-explained" class="level3">
<h3 class="anchored" data-anchor-id="state-fields-explained">State Fields Explained</h3>
<ul>
<li><strong><code>domain_name</code></strong>: Input domain (e.g., “covertcameras.com”)</li>
<li><strong><code>classification_output</code></strong>: LLM-generated classification and buyer personas (markdown text)</li>
<li><strong><code>supervisor_messages</code></strong>: Message history for the research supervisor (uses <code>override_reducer</code> to replace, not append)</li>
<li><strong><code>research_brief</code></strong>: Research guidance (initially set to <code>classification_output</code>)</li>
<li><strong><code>notes</code></strong>: Research notes from supervisor and researchers (accumulated via <code>override_reducer</code>)</li>
<li><strong><code>leads</code></strong>: Final structured leads (accumulated from both paths, then deduplicated)</li>
</ul>
</section>
<section id="reducer-functions" class="level3">
<h3 class="anchored" data-anchor-id="reducer-functions">Reducer Functions</h3>
<p><strong><code>override_reducer</code></strong>: Used for fields that should be replaced rather than appended: - <code>supervisor_messages</code>: Replaced entirely when supervisor is seeded - <code>leads</code>: Can be overridden during deduplication</p>
<p><strong><code>operator.add</code></strong> (default): Used for fields that accumulate: - <code>notes</code>: Appends new notes to existing list - <code>leads</code>: Initially accumulates leads from both paths</p>
</section>
<section id="state-flow-through-workflow" class="level3">
<h3 class="anchored" data-anchor-id="state-flow-through-workflow">State Flow Through Workflow</h3>
<pre><code>Input: {domain_name: "covertcameras.com"}
  ↓
classify_and_seed_supervisor
  → {classification_output, supervisor_messages, research_brief}
  ↓
[Parallel Execution]
  ├─ research_supervisor → {notes, leads}
  └─ dotdb_generate_leads → {leads}
  ↓
dedupe_leads
  → {leads: deduplicated_list}
  ↓
get_leads
  → {leads: final_clean_list}
  ↓
Output: {leads: [Lead, Lead, ...]}</code></pre>
<hr>
</section>
</section>
<section id="node-by-node-breakdown" class="level2">
<h2 class="anchored" data-anchor-id="node-by-node-breakdown">4. Node-by-Node Breakdown</h2>
<section id="classify_and_seed_supervisor" class="level3">
<h3 class="anchored" data-anchor-id="classify_and_seed_supervisor">4.1 classify_and_seed_supervisor</h3>
<p><strong>Location</strong>: <code>src/lead_gen/agent.py:70-114</code></p>
<p><strong>Purpose</strong>: - Classify the input domain into business categories - Generate tiered buyer personas - Initialize the research supervisor with classification context</p>
<p><strong>Input State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"domain_name"</span>: <span class="st">"covertcameras.com"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Processing Logic</strong>:</p>
<ol type="1">
<li><strong>Domain Classification</strong>:
<ul>
<li>Uses <code>classification_and_buyers_prompt</code> from <code>classify_prompts.py</code></li>
<li>LLM analyzes domain against 11 category classification guide</li>
<li>Generates classification summary and tiered buyer personas (Tier 1-4)</li>
</ul></li>
<li><strong>Supervisor Seeding</strong>:
<ul>
<li>Creates <code>leadgen_supervisor_prompt</code> (customized supervisor instructions)</li>
<li>Seeds supervisor with:
<ul>
<li>System message: LeadGen-specific supervisor prompt</li>
<li>Human message: Classification output (as research brief)</li>
</ul></li>
</ul></li>
<li><strong>State Initialization</strong>:
<ul>
<li>Sets <code>classification_output</code> to LLM response</li>
<li>Sets <code>research_brief</code> to classification output</li>
<li>Overrides <code>supervisor_messages</code> with initial context</li>
</ul></li>
</ol>
<p><strong>Output State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"classification_output"</span>: <span class="st">"✅ Classification: Category 6: Product/Service..."</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"research_brief"</span>: <span class="st">"✅ Classification: Category 6: Product/Service..."</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"supervisor_messages"</span>: {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span>: <span class="st">"override"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"value"</span>: [</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            SystemMessage(content<span class="op">=</span>leadgen_supervisor_prompt),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            HumanMessage(content<span class="op">=</span>classification_output)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Code References</strong>: - Classification prompt: <code>src/lead_gen/classify_prompts.py:3-43</code> - Classification guide: <code>src/lead_gen/classify_prompts.py:46-99</code> - Supervisor prompt: <code>src/lead_gen/classify_prompts.py:102-162</code></p>
<p><strong>Model Configuration</strong>: - Uses <code>research_model</code> from configuration - Structured output not required (free-form text) - Retry logic: <code>max_structured_output_retries</code></p>
<hr>
</section>
<section id="research_supervisor" class="level3">
<h3 class="anchored" data-anchor-id="research_supervisor">4.2 research_supervisor</h3>
<p><strong>Location</strong>: <code>src/open_deep_research/deep_researcher.py:186-389</code> (supervisor subgraph)</p>
<p><strong>Purpose</strong>: - Orchestrate web research to find companies matching buyer personas - Delegate research tasks to parallel researchers - Extract leads from research findings</p>
<p><strong>Input State</strong> (from LeadGen context):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"supervisor_messages"</span>: [SystemMessage, HumanMessage],  <span class="co"># Seeded by classify_and_seed_supervisor</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"research_brief"</span>: <span class="st">"Classification and buyer personas..."</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"notes"</span>: [],</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leads"</span>: []</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Processing Logic</strong>:</p>
<p>The supervisor subgraph operates in a loop:</p>
<ol type="1">
<li><strong>Supervisor Node</strong> (<code>supervisor</code>):
<ul>
<li>Analyzes research brief and current findings</li>
<li>Uses tools:
<ul>
<li><code>think_tool</code>: Strategic reflection</li>
<li><code>ConductResearch</code>: Delegate research tasks</li>
<li><code>ResearchComplete</code>: Signal completion</li>
</ul></li>
<li>Generates tool calls based on buyer personas</li>
</ul></li>
<li><strong>Supervisor Tools Node</strong> (<code>supervisor_tools</code>):
<ul>
<li>Executes tool calls from supervisor</li>
<li>For <code>ConductResearch</code>: Spawns researcher subgraph</li>
<li>For <code>think_tool</code>: Continues conversation</li>
<li>For <code>ResearchComplete</code>: Exits loop</li>
</ul></li>
<li><strong>Researcher Subgraph</strong> (spawned per <code>ConductResearch</code>):
<ul>
<li>Receives specific research topic (e.g., “Find companies that sell surveillance cameras”)</li>
<li>Uses web search tools (Jina, Tavily, etc.) to find companies</li>
<li>Iterates with tool calls (max <code>max_react_tool_calls</code>)</li>
<li>Compresses research findings</li>
<li><strong>Extracts leads</strong> from compressed research using <code>extract_leads_from_research</code></li>
</ul></li>
<li><strong>Lead Extraction</strong>:
<ul>
<li>Function: <code>extract_leads_from_research</code> (<code>src/open_deep_research/deep_researcher.py:539-604</code>)</li>
<li>Takes compressed research and raw notes</li>
<li>Uses LLM with structured output (<code>LeadList</code> schema)</li>
<li>Extracts companies with websites, summaries, rationales, tiers</li>
</ul></li>
</ol>
<p><strong>Output State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"supervisor_messages"</span>: [...],  <span class="co"># Full conversation history</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"notes"</span>: [<span class="st">"Research note 1"</span>, <span class="st">"Research note 2"</span>, ...],</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leads"</span>: [</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"website"</span>: <span class="st">"https://example.com"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"detailed_summary"</span>: <span class="st">"..."</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"..."</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tier"</span>: <span class="st">"Tier 1"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"meta_data"</span>: {...}</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Code References</strong>: - Supervisor subgraph: <code>src/open_deep_research/deep_researcher.py:377-389</code> - Supervisor node: <code>src/open_deep_research/deep_researcher.py:186-233</code> - Supervisor tools: <code>src/open_deep_research/deep_researcher.py:235-375</code> - Lead extraction: <code>src/open_deep_research/deep_researcher.py:539-604</code> - Researcher subgraph: <code>src/open_deep_research/deep_researcher.py:694-720</code> - Compress research: <code>src/open_deep_research/deep_researcher.py:607-692</code></p>
<p><strong>Configuration</strong>: - <code>max_researcher_iterations</code>: Max supervisor loop iterations (default: 5) - <code>max_react_tool_calls</code>: Max tool calls per researcher (default: 4) - <code>max_concurrent_research_units</code>: Max parallel researchers (default: 5)</p>
<hr>
</section>
<section id="dotdb_generate_leads" class="level3">
<h3 class="anchored" data-anchor-id="dotdb_generate_leads">4.3 dotdb_generate_leads</h3>
<p><strong>Location</strong>: <code>src/lead_gen/agent.py:305-325</code></p>
<p><strong>Purpose</strong>: - Invoke the DotDB subgraph to generate leads from keyword-based domain matching - Convert DotDB subgraph output to Lead objects</p>
<p><strong>Input State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"domain_name"</span>: <span class="st">"covertcameras.com"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"classification_output"</span>: <span class="st">"✅ Classification: ..."</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Processing Logic</strong>:</p>
<ol type="1">
<li><strong>Invoke DotDB Subgraph</strong>:
<ul>
<li>Calls <code>dotdb_subgraph.ainvoke()</code> with domain and classification</li>
<li>DotDB subgraph executes full flow (see Section 5)</li>
</ul></li>
<li><strong>Extract Leads</strong>:
<ul>
<li>Gets <code>leads</code> from DotDB subgraph output</li>
<li>Converts dict leads to <code>Lead</code> Pydantic models</li>
</ul></li>
<li><strong>Return Leads</strong>:
<ul>
<li>Returns leads in LeadGen state format</li>
</ul></li>
</ol>
<p><strong>Output State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leads"</span>: [</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        Lead(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            website<span class="op">=</span><span class="st">"https://example.com"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            detailed_summary<span class="op">=</span><span class="st">"..."</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            rationale<span class="op">=</span><span class="st">"..."</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            tier<span class="op">=</span><span class="st">"Tier 1"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            meta_data<span class="op">=</span>{...}</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Code References</strong>: - DotDB subgraph invocation: <code>src/lead_gen/agent.py:308-311</code> - Lead conversion: <code>src/lead_gen/agent.py:314-324</code> - DotDB subgraph: <code>src/lead_gen/dotdb_subgraph.py:342-358</code></p>
<hr>
</section>
<section id="dedupe_leads" class="level3">
<h3 class="anchored" data-anchor-id="dedupe_leads">4.4 dedupe_leads</h3>
<p><strong>Location</strong>: <code>src/lead_gen/agent.py:168-232</code></p>
<p><strong>Purpose</strong>: - Deduplicate leads from both research paths based on normalized website URLs - Keep leads with more information when duplicates are found</p>
<p><strong>Input State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leads"</span>: [</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        Lead(website<span class="op">=</span><span class="st">"https://www.example.com"</span>, ...),  <span class="co"># From research_supervisor</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        Lead(website<span class="op">=</span><span class="st">"example.com"</span>, ...),              <span class="co"># From dotdb_generate_leads (duplicate)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        Lead(website<span class="op">=</span><span class="st">"https://other.com"</span>, ...),         <span class="co"># Unique</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Processing Logic</strong>:</p>
<ol type="1">
<li><strong>Normalize Websites</strong>:
<ul>
<li>Uses <code>normalize_website()</code> function with <code>tldextract</code></li>
<li>Extracts registered domain (domain + suffix)</li>
<li>Handles:
<ul>
<li>Protocols (http://, https://)</li>
<li>Subdomains (www, api, etc.)</li>
<li>Paths and query parameters</li>
<li>Two-part TLDs (co.uk, com.au, etc.)</li>
</ul></li>
</ul></li>
<li><strong>Deduplication Algorithm</strong>:
<ul>
<li>Uses dictionary for O(1) lookup: <code>{normalized_domain: (index, Lead)}</code></li>
<li>For each lead:
<ul>
<li>Normalize website URL</li>
<li>If not seen: Add to deduplicated list</li>
<li>If duplicate: Compare information richness
<ul>
<li>Keep lead with longer <code>detailed_summary</code></li>
<li>Or keep lead with <code>meta_data</code> if other doesn’t have it</li>
</ul></li>
</ul></li>
</ul></li>
<li><strong>Override State</strong>:
<ul>
<li>Uses <code>override_reducer</code> pattern to replace leads list</li>
</ul></li>
</ol>
<p><strong>Output State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leads"</span>: {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span>: <span class="st">"override"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"value"</span>: [</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            Lead(website<span class="op">=</span><span class="st">"https://www.example.com"</span>, ...),  <span class="co"># Kept (more info)</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            Lead(website<span class="op">=</span><span class="st">"https://other.com"</span>, ...),         <span class="co"># Unique</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            ...</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Code References</strong>: - Deduplication logic: <code>src/lead_gen/agent.py:168-232</code> - Normalize website: <code>src/lead_gen/agent.py:117-165</code></p>
<p><strong>Example Normalization</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>normalize_website(<span class="st">"https://www.example.com/path?query=1"</span>)  <span class="co"># → "example.com"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>normalize_website(<span class="st">"http://api.example.co.uk"</span>)              <span class="co"># → "example.co.uk"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>normalize_website(<span class="st">"www.test.io"</span>)                            <span class="co"># → "test.io"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
<section id="get_leads" class="level3">
<h3 class="anchored" data-anchor-id="get_leads">4.5 get_leads</h3>
<p><strong>Location</strong>: <code>src/lead_gen/agent.py:235-302</code></p>
<p><strong>Purpose</strong>: - Final deduplication pass (handles serialization edge cases) - Ensure leads are properly formatted as Lead objects - Return clean, final lead list</p>
<p><strong>Input State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leads"</span>: [</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        Lead(...),  <span class="co"># Already deduplicated</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Processing Logic</strong>:</p>
<ol type="1">
<li><strong>Handle Serialization</strong>:
<ul>
<li>Converts dict leads (from serialized state) to Lead objects</li>
<li>Handles cases where state was serialized/deserialized (e.g., in LangSmith traces)</li>
</ul></li>
<li><strong>Final Deduplication</strong>:
<ul>
<li>Performs same deduplication logic as <code>dedupe_leads</code></li>
<li>Ensures no duplicates after serialization/deserialization</li>
</ul></li>
<li><strong>Override State</strong>:
<ul>
<li>Uses <code>override_reducer</code> pattern to return final clean list</li>
</ul></li>
</ol>
<p><strong>Output State</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leads"</span>: {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span>: <span class="st">"override"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"value"</span>: [</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>            Lead(...),  <span class="co"># Final deduplicated, formatted leads</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            ...</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Code References</strong>: - Final deduplication: <code>src/lead_gen/agent.py:235-302</code></p>
<p><strong>Why Two Deduplication Steps?</strong> - <code>dedupe_leads</code>: Handles initial merge from parallel paths - <code>get_leads</code>: Handles edge cases from state serialization (especially in shared traces)</p>
<hr>
</section>
</section>
<section id="dotdb-subgraph-deep-dive" class="level2">
<h2 class="anchored" data-anchor-id="dotdb-subgraph-deep-dive">5. DotDB Subgraph Deep Dive</h2>
<p>The DotDB subgraph is a complete workflow that generates leads from keyword-based domain matching. It’s defined in <code>src/lead_gen/dotdb_subgraph.py</code>.</p>
<section id="dotdb-subgraph-flow" class="level3">
<h3 class="anchored" data-anchor-id="dotdb-subgraph-flow">5.1 DotDB Subgraph Flow</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                         START                                    │
│              (domain_name, classification_output)               │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│              generate_dotdb_keywords                           │
│  • Extract SLD from domain                                     │
│  • Use LLM to generate search keywords                        │
│  • Parse JSON_TOP_TIER or Top Tier bullets                    │
│  • Build variants (hyphenated, compact)                        │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│              fetch_dotdb_domains                                │
│  • Bulk API call for all keywords                              │
│  • Extract active domains from response                        │
│  • Filter by exact SLD match                                   │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│              check_jina_api                                     │
│  • Validate domains via Jina API                               │
│  • Concurrent requests (limit: 10)                             │
│  • Filter successful responses                                 │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│              jina_results_to_leads                             │
│  • For each successful Jina result                             │
│  • Use LLM to extract lead information                         │
│  • Return structured leads                                     │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                          END                                    │
│                    (leads list output)                          │
└─────────────────────────────────────────────────────────────────┘</code></pre>
</section>
<section id="dotdbstate-structure" class="level3">
<h3 class="anchored" data-anchor-id="dotdbstate-structure">5.2 DotDBState Structure</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DotDBState(TypedDict):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    domain_name: <span class="bu">str</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    classification_output: Optional[<span class="bu">str</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    generated_keywords: Annotated[List[<span class="bu">str</span>], <span class="kw">lambda</span> x, y: y]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    dotdb_domains: Annotated[List[<span class="bu">str</span>], <span class="kw">lambda</span> x, y: y]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    jina_results: Annotated[List[Dict[<span class="bu">str</span>, Any]], <span class="kw">lambda</span> x, y: y]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    active_domains: Annotated[List[<span class="bu">str</span>], <span class="kw">lambda</span> x, y: y]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    leads: Annotated[List[Dict[<span class="bu">str</span>, Any]], <span class="kw">lambda</span> x, y: y]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Location</strong>: <code>src/lead_gen/dotdb_subgraph.py:27-35</code></p>
</section>
<section id="node-details" class="level3">
<h3 class="anchored" data-anchor-id="node-details">5.3 Node Details</h3>
<section id="generate_dotdb_keywords" class="level4">
<h4 class="anchored" data-anchor-id="generate_dotdb_keywords">5.3.1 generate_dotdb_keywords</h4>
<p><strong>Location</strong>: <code>src/lead_gen/dotdb_subgraph.py:51-154</code></p>
<p><strong>Purpose</strong>: Generate DotDB search keywords from domain using LLM</p>
<p><strong>Processing</strong>:</p>
<ol type="1">
<li><strong>Extract SLD</strong>:
<ul>
<li>Uses <code>extract_sld()</code> with <code>tldextract</code></li>
<li>Example: “covertcameras.com” → “covertcameras”</li>
</ul></li>
<li><strong>LLM Keyword Generation</strong>:
<ul>
<li>Uses <code>DOTDB_KEYWORD_GEN_PROMPT</code> (strict prompt with rules)</li>
<li>LLM generates:
<ul>
<li>Top Tier keywords (5-12 items with scores)</li>
<li>Exact-Phrase Family</li>
<li>Geo-Expanded Family</li>
<li>Specialty/Niche Family</li>
<li>Brand/Org Structure Family</li>
<li>Marketing/Affiliate Family</li>
<li>Abbreviation/Shortform Family</li>
<li>Misspelling/Defensive Family (if applicable)</li>
</ul></li>
</ul></li>
<li><strong>Parse Output</strong>:
<ul>
<li>Prefers machine-readable <code>JSON_TOP_TIER:</code> line</li>
<li>Fallback: Parse Top Tier bullet section</li>
<li>Final fallback: Use SLD if no keywords found</li>
</ul></li>
<li><strong>Build Variants</strong>:
<ul>
<li>For each keyword, creates variants:
<ul>
<li>Hyphenated: “covert camera” → “covert-camera”</li>
<li>Compact: “covert camera” → “covertcamera”</li>
</ul></li>
<li>Limits to 80 total keywords</li>
</ul></li>
</ol>
<p><strong>Key Code References</strong>: - Keyword generation: <code>src/lead_gen/dotdb_subgraph.py:51-154</code> - Prompt: <code>src/lead_gen/classify_prompts.py:164-264</code> - SLD extraction: <code>src/lead_gen/dotdb_subgraph.py:45-48</code></p>
<p><strong>Output</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"generated_keywords"</span>: [</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"covertcamera"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"covert-camera"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"covertcamera-vehicles"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="fetch_dotdb_domains" class="level4">
<h4 class="anchored" data-anchor-id="fetch_dotdb_domains">5.3.2 fetch_dotdb_domains</h4>
<p><strong>Location</strong>: <code>src/lead_gen/dotdb_subgraph.py:157-196</code></p>
<p><strong>Purpose</strong>: Fetch active domains from DotDB API for generated keywords</p>
<p><strong>Processing</strong>:</p>
<ol type="1">
<li><strong>Bulk API Call</strong>:
<ul>
<li>Uses <code>DotDBClient.get_active_domains()</code> with all keywords</li>
<li>Single POST request to <code>/dotdb/getleads/bulk</code></li>
<li>Returns domains grouped by keyword</li>
</ul></li>
<li><strong>Flatten and Deduplicate</strong>:
<ul>
<li>Flattens domains from all keywords into single list</li>
<li>Removes duplicates</li>
</ul></li>
<li><strong>Exact SLD Filter</strong>:
<ul>
<li>Extracts SLD from each domain</li>
<li>Keeps only domains whose SLD exactly matches a generated keyword</li>
<li>Filters out domains with different SLDs</li>
</ul></li>
</ol>
<p><strong>Key Code References</strong>: - Domain fetching: <code>src/lead_gen/dotdb_subgraph.py:157-196</code> - DotDB client: <code>src/lead_gen/clients/dotdb_client.py:17-99</code></p>
<p><strong>Output</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dotdb_domains"</span>: [</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"covertcamera.com"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"covert-camera.io"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"covertcameravehicles.net"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="check_jina_api" class="level4">
<h4 class="anchored" data-anchor-id="check_jina_api">5.3.3 check_jina_api</h4>
<p><strong>Location</strong>: <code>src/lead_gen/dotdb_subgraph.py:199-252</code></p>
<p><strong>Purpose</strong>: Validate domains via Jina API to ensure they’re active websites</p>
<p><strong>Processing</strong>:</p>
<ol type="1">
<li><strong>Concurrent Requests</strong>:
<ul>
<li>Uses <code>asyncio.Semaphore</code> to limit concurrency (10 simultaneous)</li>
<li>Creates tasks for each domain</li>
</ul></li>
<li><strong>Jina API Call</strong>:
<ul>
<li>Uses <code>JinaClient.fetch_site_info()</code> for each domain</li>
<li>Extracts SLD and queries Jina search API</li>
<li>Uses <code>X-Site</code> header to target specific domain</li>
</ul></li>
<li><strong>Response Processing</strong>:
<ul>
<li>Checks if response is successful (<code>code == 200 &amp;&amp; status == 20000</code>)</li>
<li>Extracts: title, url, content, description</li>
<li>Marks as success/failure</li>
</ul></li>
<li><strong>Filter Active Domains</strong>:
<ul>
<li>Returns only domains with successful Jina responses</li>
<li>Logs failures for debugging</li>
</ul></li>
</ol>
<p><strong>Key Code References</strong>: - Jina validation: <code>src/lead_gen/dotdb_subgraph.py:199-252</code> - Jina client: <code>src/lead_gen/clients/jina_client.py:44-133</code></p>
<p><strong>Output</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jina_results"</span>: [</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"domain"</span>: <span class="st">"covertcamera.com"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"title"</span>: <span class="st">"Covert Camera Systems"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"url"</span>: <span class="st">"https://covertcamera.com"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: <span class="st">"..."</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"..."</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"success"</span>: <span class="va">True</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"active_domains"</span>: [</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"covertcamera.com"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"covert-camera.io"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="jina_results_to_leads" class="level4">
<h4 class="anchored" data-anchor-id="jina_results_to_leads">5.3.4 jina_results_to_leads</h4>
<p><strong>Location</strong>: <code>src/lead_gen/dotdb_subgraph.py:255-339</code></p>
<p><strong>Purpose</strong>: Extract structured leads from Jina API results using LLM</p>
<p><strong>Processing</strong>:</p>
<ol type="1">
<li><strong>Filter Successful Results</strong>:
<ul>
<li>Only processes domains with <code>success: True</code></li>
</ul></li>
<li><strong>LLM Lead Extraction</strong> (per domain):
<ul>
<li>Creates prompt with:
<ul>
<li>Domain, URL, title, description, content (truncated to 4000 chars)</li>
<li>Classification guidance from <code>classification_output</code></li>
<li>Few-shot examples</li>
</ul></li>
<li>LLM extracts lead information:
<ul>
<li><code>website</code>: Exact URL</li>
<li><code>detailed_summary</code>: 2-4 sentences about the company</li>
<li><code>rationale</code>: Why this is a relevant buyer</li>
<li><code>tier</code>: Tier 1/2/3 classification</li>
<li><code>meta_data</code>: Optional metadata (domain, title, signals, etc.)</li>
</ul></li>
</ul></li>
<li><strong>JSON Parsing</strong>:
<ul>
<li>Parses LLM JSON response</li>
<li>Validates required fields</li>
<li>Skips invalid responses</li>
</ul></li>
</ol>
<p><strong>Key Code References</strong>: - Lead extraction: <code>src/lead_gen/dotdb_subgraph.py:255-339</code></p>
<p><strong>Output</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leads"</span>: [</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"website"</span>: <span class="st">"https://covertcamera.com"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"detailed_summary"</span>: <span class="st">"Covert Camera Systems provides enterprise surveillance solutions..."</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Direct B2B provider of surveillance products/services aligned with category."</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tier"</span>: <span class="st">"Tier 1"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"meta_data"</span>: {</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"domain"</span>: <span class="st">"covertcamera.com"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"title"</span>: <span class="st">"Covert Camera Systems"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"signals"</span>: {<span class="st">"active"</span>: <span class="va">True</span>}</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="dotdb-subgraph-compilation" class="level3">
<h3 class="anchored" data-anchor-id="dotdb-subgraph-compilation">5.4 DotDB Subgraph Compilation</h3>
<p><strong>Location</strong>: <code>src/lead_gen/dotdb_subgraph.py:342-358</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dotdb_builder <span class="op">=</span> StateGraph(DotDBState)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_node(<span class="st">"generate_dotdb_keywords"</span>, generate_dotdb_keywords)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_node(<span class="st">"fetch_dotdb_domains"</span>, fetch_dotdb_domains)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_node(<span class="st">"check_jina_api"</span>, check_jina_api)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_node(<span class="st">"jina_results_to_leads"</span>, jina_results_to_leads)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_edge(START, <span class="st">"generate_dotdb_keywords"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_edge(<span class="st">"generate_dotdb_keywords"</span>, <span class="st">"fetch_dotdb_domains"</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_edge(<span class="st">"fetch_dotdb_domains"</span>, <span class="st">"check_jina_api"</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_edge(<span class="st">"check_jina_api"</span>, <span class="st">"jina_results_to_leads"</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>dotdb_builder.add_edge(<span class="st">"jina_results_to_leads"</span>, END)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>dotdb_subgraph <span class="op">=</span> dotdb_builder.<span class="bu">compile</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="research-supervisor-integration" class="level2">
<h2 class="anchored" data-anchor-id="research-supervisor-integration">6. Research Supervisor Integration</h2>
<p>The research supervisor is a subgraph from the main Deep Research workflow, reused in LeadGen with customized prompts.</p>
<section id="supervisor-subgraph-structure" class="level3">
<h3 class="anchored" data-anchor-id="supervisor-subgraph-structure">6.1 Supervisor Subgraph Structure</h3>
<p><strong>Location</strong>: <code>src/open_deep_research/deep_researcher.py:377-389</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>supervisor_builder <span class="op">=</span> StateGraph(SupervisorState, config_schema<span class="op">=</span>Configuration)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>supervisor_builder.add_node(<span class="st">"supervisor"</span>, supervisor)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>supervisor_builder.add_node(<span class="st">"supervisor_tools"</span>, supervisor_tools)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>supervisor_builder.add_edge(START, <span class="st">"supervisor"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop: supervisor ↔ supervisor_tools</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>supervisor_subgraph <span class="op">=</span> supervisor_builder.<span class="bu">compile</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="leadgen-specific-customization" class="level3">
<h3 class="anchored" data-anchor-id="leadgen-specific-customization">6.2 LeadGen-Specific Customization</h3>
<p><strong>Custom Supervisor Prompt</strong>: <code>src/lead_gen/classify_prompts.py:102-162</code></p>
<p>The <code>leadgen_supervisor_prompt</code> is customized for domain brokerage:</p>
<ul>
<li>Focuses on finding companies matching buyer personas</li>
<li>Emphasizes finding real companies with official websites</li>
<li>Instructs to prioritize companies that match classification categories</li>
<li>Prohibits using acronyms/abbreviations in research questions</li>
</ul>
<p><strong>Seeding Process</strong>: <code>src/lead_gen/agent.py:98-113</code></p>
<ol type="1">
<li>System message: <code>leadgen_supervisor_prompt</code></li>
<li>Human message: <code>classification_output</code> (buyer personas)</li>
</ol>
</section>
<section id="supervisor-loop-flow" class="level3">
<h3 class="anchored" data-anchor-id="supervisor-loop-flow">6.3 Supervisor Loop Flow</h3>
<pre><code>supervisor
  ↓
  [Analyze research brief and findings]
  ↓
  [Generate tool calls: think_tool, ConductResearch, or ResearchComplete]
  ↓
supervisor_tools
  ↓
  [Execute tool calls]
  ↓
  ├─ think_tool → Continue to supervisor
  ├─ ConductResearch → Spawn researcher subgraph
  └─ ResearchComplete → Exit to END</code></pre>
</section>
<section id="researcher-subgraph" class="level3">
<h3 class="anchored" data-anchor-id="researcher-subgraph">6.4 Researcher Subgraph</h3>
<p><strong>Location</strong>: <code>src/open_deep_research/deep_researcher.py:694-720</code></p>
<p>When supervisor calls <code>ConductResearch</code>, it spawns a researcher subgraph:</p>
<pre><code>researcher
  ↓
  [Use tools: web_search, jina_read_url, think_tool, etc.]
  ↓
researcher_tools
  ↓
  [Execute tool calls]
  ↓
  ├─ More tool calls needed → Continue to researcher
  └─ Max iterations reached → compress_research
  ↓
compress_research
  ↓
  [Compress research findings]
  ↓
  [Extract leads via extract_leads_from_research]
  ↓
  Return: {compressed_research, raw_notes, leads}</code></pre>
</section>
<section id="lead-extraction-in-research" class="level3">
<h3 class="anchored" data-anchor-id="lead-extraction-in-research">6.5 Lead Extraction in Research</h3>
<p><strong>Location</strong>: <code>src/open_deep_research/deep_researcher.py:539-604</code></p>
<p>After research is compressed, <code>extract_leads_from_research</code> is called:</p>
<ol type="1">
<li><strong>Input</strong>: Compressed research text + raw notes</li>
<li><strong>LLM Extraction</strong>: Uses structured output (<code>LeadList</code> schema)</li>
<li><strong>Output</strong>: List of lead dictionaries</li>
</ol>
<p><strong>Prompt Structure</strong>:</p>
<pre><code>Extract potential leads from the following research findings.
Focus on companies, organizations, or individuals who might be interested in the domain.

RESEARCH SUMMARY: {compressed_research}
RAW NOTES: {raw_notes}

For each lead, provide:
- website: The company's website URL
- detailed_summary: Why they'd be interested in the domain
- rationale: Your reasoning for this lead
- tier: Optional classification tier
- meta_data: Any additional relevant information

Only include real, verifiable leads with valid websites.</code></pre>
</section>
<section id="state-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="state-aggregation">6.6 State Aggregation</h3>
<p>Leads from multiple researchers are aggregated in supervisor state:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SupervisorState(TypedDict):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    supervisor_messages: Annotated[<span class="bu">list</span>[MessageLikeRepresentation], override_reducer]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    research_brief: <span class="bu">str</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    notes: Annotated[<span class="bu">list</span>[<span class="bu">str</span>], override_reducer] <span class="op">=</span> []</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    research_iterations: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    raw_notes: Annotated[<span class="bu">list</span>[<span class="bu">str</span>], override_reducer] <span class="op">=</span> []</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    leads: Annotated[<span class="bu">list</span>[<span class="bu">dict</span>], override_reducer] <span class="op">=</span> []  <span class="co"># Accumulated from researchers</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Location</strong>: <code>src/open_deep_research/state.py:74-82</code></p>
<hr>
</section>
</section>
<section id="lead-data-structure" class="level2">
<h2 class="anchored" data-anchor-id="lead-data-structure">7. Lead Data Structure</h2>
<section id="lead-model" class="level3">
<h3 class="anchored" data-anchor-id="lead-model">7.1 Lead Model</h3>
<p><strong>Location</strong>: <code>src/lead_gen/agent.py:56-63</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Lead(BaseModel):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    website: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Canonical website or domain of the lead"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    detailed_summary: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Detailed, actionable summary of why this is a fit"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    rationale: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Short justification tying back to classification/buyer tiers"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    tier: Optional[<span class="bu">str</span>] <span class="op">=</span> Field(<span class="va">None</span>, description<span class="op">=</span><span class="st">"Buyer or classification tier for this lead"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    meta_data: Optional[Dict[<span class="bu">str</span>, Any]] <span class="op">=</span> Field(</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        default<span class="op">=</span><span class="va">None</span>, description<span class="op">=</span><span class="st">"Optional metadata such as contact hints, geo, size"</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="field-descriptions" class="level3">
<h3 class="anchored" data-anchor-id="field-descriptions">7.2 Field Descriptions</h3>
<ul>
<li><strong><code>website</code></strong>: Canonical URL or domain (e.g., “https://example.com” or “example.com”)</li>
<li><strong><code>detailed_summary</code></strong>: 2-4 sentences explaining the company’s business and why they’d want the domain</li>
<li><strong><code>rationale</code></strong>: 1-2 sentences tying the lead back to classification categories or buyer personas</li>
<li><strong><code>tier</code></strong>: Buyer tier classification (e.g., “Tier 1”, “Tier 2”, “Tier 3”, “Strategic”)</li>
<li><strong><code>meta_data</code></strong>: Optional dictionary with additional information:
<ul>
<li><code>domain</code>: Domain name</li>
<li><code>title</code>: Company name/title</li>
<li><code>signals</code>: Activity signals (e.g., <code>{"active": True}</code>)</li>
<li><code>geo</code>: Geographic information</li>
<li><code>contact</code>: Contact hints</li>
<li><code>size</code>: Company size indicators</li>
</ul></li>
</ul>
</section>
<section id="leadlist-model" class="level3">
<h3 class="anchored" data-anchor-id="leadlist-model">7.3 LeadList Model</h3>
<p><strong>Location</strong>: <code>src/lead_gen/agent.py:66-67</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LeadList(BaseModel):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    leads: List[Lead] <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"List of extracted leads from web search results"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Used for structured LLM output when extracting leads.</p>
</section>
<section id="example-lead" class="level3">
<h3 class="anchored" data-anchor-id="example-lead">7.4 Example Lead</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Lead(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    website<span class="op">=</span><span class="st">"https://acme-security.com"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    detailed_summary<span class="op">=</span><span class="st">"Acme Security provides enterprise-grade surveillance systems, including IP cameras, VMS, and integration services for logistics and retail. Their offerings emphasize compliance, 24/7 monitoring, and on-site deployment support."</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    rationale<span class="op">=</span><span class="st">"Direct B2B provider of surveillance products/services aligned with category."</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    tier<span class="op">=</span><span class="st">"Tier 1"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    meta_data<span class="op">=</span>{</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"domain"</span>: <span class="st">"acme-security.com"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"title"</span>: <span class="st">"Acme Security"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"signals"</span>: {<span class="st">"active"</span>: <span class="va">True</span>}</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">8. Configuration</h2>
<section id="leadgenconfiguration" class="level3">
<h3 class="anchored" data-anchor-id="leadgenconfiguration">8.1 LeadGenConfiguration</h3>
<p><strong>Location</strong>: <code>src/lead_gen/configuration.py:7-11</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LeadGenConfiguration(BaseModel):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    scraper_url: <span class="bu">str</span> <span class="op">=</span> Field(default_factory<span class="op">=</span><span class="kw">lambda</span>: os.getenv(<span class="st">"SCRAPER_URL"</span>, <span class="st">"http://localhost:3000/api/"</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    dotdb_url: <span class="bu">str</span> <span class="op">=</span> Field(default_factory<span class="op">=</span><span class="kw">lambda</span>: os.getenv(<span class="st">"DOTDB_URL"</span>, <span class="st">"https://amp2-1.grayriver-ffcf7337.westus.azurecontainerapps.io"</span>))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    jina_api_key: <span class="bu">str</span> <span class="op">=</span> Field(default_factory<span class="op">=</span><span class="kw">lambda</span>: os.getenv(<span class="st">"JINA_API_KEY"</span>, <span class="st">""</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Environment Variables</strong>: - <code>SCRAPER_URL</code>: URL for scraping API (default: <code>http://localhost:3000/api/</code>) - <code>DOTDB_URL</code>: Base URL for DotDB API - <code>JINA_API_KEY</code>: Jina AI API key</p>
</section>
<section id="configuration-from-open-deep-research" class="level3">
<h3 class="anchored" data-anchor-id="configuration-from-open-deep-research">8.2 Configuration (from Open Deep Research)</h3>
<p>LeadGen uses the main <code>Configuration</code> class from <code>open_deep_research.configuration</code>:</p>
<p><strong>Key Settings</strong>: - <code>research_model</code>: Model for research (default: <code>openai:gpt-4.1</code>) - <code>research_model_max_tokens</code>: Max output tokens (default: 8000) - <code>max_researcher_iterations</code>: Max supervisor iterations (default: 5) - <code>max_react_tool_calls</code>: Max tool calls per researcher (default: 4) - <code>max_concurrent_research_units</code>: Max parallel researchers (default: 5) - <code>max_structured_output_retries</code>: Retry attempts (default: 3) - <code>search_api</code>: Search API to use (TAVILY, JINA, ANTHROPIC, OPENAI, NONE)</p>
<p><strong>Location</strong>: <code>src/open_deep_research/configuration.py:39-257</code></p>
</section>
<section id="environment-variable-override" class="level3">
<h3 class="anchored" data-anchor-id="environment-variable-override">8.3 Environment Variable Override</h3>
<p>Configuration values can be overridden via environment variables (uppercase):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="va">RESEARCH_MODEL</span><span class="op">=</span>openai:gpt-4.1</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="va">RESEARCH_MODEL_MAX_TOKENS</span><span class="op">=</span>6000</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="va">MAX_RESEARCHER_ITERATIONS</span><span class="op">=</span>5</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="va">SEARCH_API</span><span class="op">=</span>jina</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Priority Order</strong>: 1. Environment variables (highest) 2. <code>RunnableConfig.configurable</code> 3. Default values (lowest)</p>
<p><strong>Location</strong>: <code>src/open_deep_research/configuration.py:242-252</code></p>
<hr>
</section>
</section>
<section id="api-clients" class="level2">
<h2 class="anchored" data-anchor-id="api-clients">9. API Clients</h2>
<section id="dotdbclient" class="level3">
<h3 class="anchored" data-anchor-id="dotdbclient">9.1 DotDBClient</h3>
<p><strong>Location</strong>: <code>src/lead_gen/clients/dotdb_client.py:5-99</code></p>
<p><strong>Purpose</strong>: Interact with DotDB API to fetch active domains for keywords</p>
<p><strong>Key Methods</strong>:</p>
<section id="get_active_domainskeywords-site_status" class="level4">
<h4 class="anchored" data-anchor-id="get_active_domainskeywords-site_status"><code>get_active_domains(keywords, site_status)</code></h4>
<p><strong>Parameters</strong>: - <code>keywords</code>: List of keywords to search (e.g., <code>["covertcamera", "marketingguru"]</code>) - <code>site_status</code>: Site status filter (default: <code>"active"</code>)</p>
<p><strong>Returns</strong>: Dictionary mapping keywords to lists of active domains:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covertcamera"</span>: [<span class="st">"covertcamera.com"</span>, <span class="st">"covertcamera.io"</span>, ...],</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"marketingguru"</span>: [<span class="st">"marketingguru.net"</span>, ...],</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>API Endpoint</strong>: <code>POST {base_url}/dotdb/getleads/bulk</code></p>
<p><strong>Request Format</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">"covertcamera"</span><span class="ot">,</span> <span class="st">"marketingguru"</span><span class="ot">,</span> <span class="er">...</span><span class="ot">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Response Format</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"covertcamera"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"matches"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">{</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"covertcamera"</span><span class="fu">,</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                <span class="dt">"site_status"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">"active_suffixes"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">".com"</span><span class="ot">,</span> <span class="st">".io"</span><span class="ot">,</span> <span class="st">".net"</span><span class="ot">]</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">}</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Usage Example</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.clients.dotdb_client <span class="im">import</span> DotDBClient</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.configuration <span class="im">import</span> LeadGenConfiguration</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> LeadGenConfiguration()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> DotDBClient(config.dotdb_url)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>domains <span class="op">=</span> <span class="cf">await</span> client.get_active_domains(</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    keywords<span class="op">=</span>[<span class="st">"covertcamera"</span>, <span class="st">"marketingguru"</span>],</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    site_status<span class="op">=</span><span class="st">"active"</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="jinaclient" class="level3">
<h3 class="anchored" data-anchor-id="jinaclient">9.2 JinaClient</h3>
<p><strong>Location</strong>: <code>src/lead_gen/clients/jina_client.py:44-133</code></p>
<p><strong>Purpose</strong>: Interact with Jina AI API to fetch website information</p>
<p><strong>Key Methods</strong>:</p>
<section id="fetch_site_infodomain" class="level4">
<h4 class="anchored" data-anchor-id="fetch_site_infodomain"><code>fetch_site_info(domain)</code></h4>
<p><strong>Parameters</strong>: - <code>domain</code>: Domain name (e.g., <code>"covertcamera.com"</code>)</p>
<p><strong>Returns</strong>: Jina API response dictionary:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"code"</span>: <span class="dv">200</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"status"</span>: <span class="dv">20000</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span>: [</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"title"</span>: <span class="st">"Covert Camera Systems"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"url"</span>: <span class="st">"https://covertcamera.com"</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: <span class="st">"..."</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"..."</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>API Endpoint</strong>: <code>GET https://s.jina.ai/?q={sld}</code></p>
<p><strong>Headers</strong>: - <code>Authorization: Bearer {api_key}</code> - <code>X-Engine: direct</code> - <code>X-Site: {domain}</code></p>
<p><strong>Helper Methods</strong>: - <code>is_success_response(response)</code>: Check if response is successful - <code>get_error_message(response)</code>: Extract error message from failed response</p>
<p><strong>Usage Example</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.clients.jina_client <span class="im">import</span> JinaClient</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.configuration <span class="im">import</span> LeadGenConfiguration</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> LeadGenConfiguration()</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> JinaClient(api_key<span class="op">=</span>config.jina_api_key)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> <span class="cf">await</span> client.fetch_site_info(<span class="st">"covertcamera.com"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> JinaClient.is_success_response(response):</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.get(<span class="st">"data"</span>, [])</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data:</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> data[<span class="dv">0</span>].get(<span class="st">"title"</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        url <span class="op">=</span> data[<span class="dv">0</span>].get(<span class="st">"url"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="scraperclient" class="level3">
<h3 class="anchored" data-anchor-id="scraperclient">9.3 ScraperClient</h3>
<p><strong>Location</strong>: <code>src/lead_gen/clients/scraping_client.py:5-25</code></p>
<p><strong>Purpose</strong>: Scrape company information from internal scraping API</p>
<p><strong>Key Methods</strong>:</p>
<section id="get_company_infocompany_domain" class="level4">
<h4 class="anchored" data-anchor-id="get_company_infocompany_domain"><code>get_company_info(company_domain)</code></h4>
<p><strong>Parameters</strong>: - <code>company_domain</code>: Company domain (e.g., <code>"swiggy.com"</code>)</p>
<p><strong>Returns</strong>: Company information dictionary or <code>None</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"name"</span>: <span class="st">"Swiggy"</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"description"</span>: <span class="st">"..."</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"revenue"</span>: <span class="st">"..."</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"employee_size"</span>: <span class="st">"..."</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"socials"</span>: {...},</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>API Endpoint</strong>: <code>POST {scraper_url}/company/tracxn</code></p>
<p><strong>Request Format</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"companyDomain"</span><span class="fu">:</span> <span class="st">"swiggy.com"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Usage Example</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.clients.scraping_client <span class="im">import</span> ScraperClient</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.configuration <span class="im">import</span> LeadGenConfiguration</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> LeadGenConfiguration()</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> ScraperClient(config)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>company_info <span class="op">=</span> <span class="cf">await</span> client.get_company_info(<span class="st">"swiggy.com"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Note</strong>: This client is available as a tool (<code>scraping_company_info</code>) in the research workflow but is not directly used in the main LeadGen flow.</p>
<hr>
</section>
</section>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">10. Troubleshooting</h2>
<section id="common-issues" class="level3">
<h3 class="anchored" data-anchor-id="common-issues">10.1 Common Issues</h3>
<section id="issue-no-leads-generated" class="level4">
<h4 class="anchored" data-anchor-id="issue-no-leads-generated">Issue: No Leads Generated</h4>
<p><strong>Symptoms</strong>: - Workflow completes successfully but <code>leads</code> list is empty</p>
<p><strong>Possible Causes</strong>: 1. Classification didn’t generate buyer personas 2. Research supervisor didn’t find matching companies 3. DotDB keywords didn’t match any domains 4. Jina API validation failed for all domains 5. Lead extraction LLM returned empty results</p>
<p><strong>Solutions</strong>: - Check <code>classification_output</code> in state - ensure buyer personas were generated - Review <code>supervisor_messages</code> - check if supervisor found companies - Check <code>generated_keywords</code> in DotDB state - ensure keywords were generated - Review <code>jina_results</code> - check if domains were validated - Check LLM responses in <code>jina_results_to_leads</code> - ensure leads were extracted</p>
<p><strong>Debug Steps</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check classification</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state.get(<span class="st">"classification_output"</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check supervisor research</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state.get(<span class="st">"notes"</span>))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state.get(<span class="st">"supervisor_messages"</span>)[<span class="op">-</span><span class="dv">1</span>].content)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check DotDB flow</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>dotdb_state <span class="op">=</span> <span class="cf">await</span> dotdb_subgraph.ainvoke({<span class="st">"domain_name"</span>: <span class="st">"example.com"</span>})</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dotdb_state.get(<span class="st">"generated_keywords"</span>))</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dotdb_state.get(<span class="st">"dotdb_domains"</span>))</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dotdb_state.get(<span class="st">"active_domains"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="issue-duplicate-leads" class="level4">
<h4 class="anchored" data-anchor-id="issue-duplicate-leads">Issue: Duplicate Leads</h4>
<p><strong>Symptoms</strong>: - Same company appears multiple times in final leads</p>
<p><strong>Possible Causes</strong>: 1. Website normalization failed (different URLs for same domain) 2. Deduplication logic bug 3. State serialization issue</p>
<p><strong>Solutions</strong>: - Check <code>normalize_website()</code> function - ensure it handles all URL variations - Verify deduplication runs in both <code>dedupe_leads</code> and <code>get_leads</code> - Check if leads have different website formats (http vs https, www vs non-www)</p>
<p><strong>Debug Steps</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.agent <span class="im">import</span> normalize_website</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test normalization</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(normalize_website(<span class="st">"https://www.example.com"</span>))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(normalize_website(<span class="st">"http://example.com"</span>))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(normalize_website(<span class="st">"example.com"</span>))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># All should return "example.com"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="issue-token-limit-exceeded" class="level4">
<h4 class="anchored" data-anchor-id="issue-token-limit-exceeded">Issue: Token Limit Exceeded</h4>
<p><strong>Symptoms</strong>: - <code>BadRequestError</code> with context length message - Workflow fails during LLM calls</p>
<p><strong>Possible Causes</strong>: 1. <code>research_model_max_tokens</code> too high 2. Classification output too long 3. Research findings too large</p>
<p><strong>Solutions</strong>: - Reduce <code>RESEARCH_MODEL_MAX_TOKENS</code> in <code>.env</code> (e.g., 6000) - Check classification output length - Reduce <code>max_researcher_iterations</code> to limit research scope</p>
<p><strong>Configuration</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="va">RESEARCH_MODEL_MAX_TOKENS</span><span class="op">=</span>6000</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="va">MAX_RESEARCHER_ITERATIONS</span><span class="op">=</span>3</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="issue-dotdb-api-errors" class="level4">
<h4 class="anchored" data-anchor-id="issue-dotdb-api-errors">Issue: DotDB API Errors</h4>
<p><strong>Symptoms</strong>: - <code>RuntimeError</code> from DotDB client - No domains returned from DotDB</p>
<p><strong>Possible Causes</strong>: 1. DotDB API unavailable 2. Invalid <code>DOTDB_URL</code> 3. Network timeout</p>
<p><strong>Solutions</strong>: - Verify <code>DOTDB_URL</code> in environment variables - Check DotDB API status - Increase timeout in <code>DotDBClient</code> if needed</p>
<p><strong>Debug Steps</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.clients.dotdb_client <span class="im">import</span> DotDBClient</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.configuration <span class="im">import</span> LeadGenConfiguration</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> LeadGenConfiguration()</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"DOTDB URL: </span><span class="sc">{</span>config<span class="sc">.</span>dotdb_url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> DotDBClient(config.dotdb_url)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    domains <span class="op">=</span> <span class="cf">await</span> client.get_active_domains([<span class="st">"test"</span>], <span class="st">"active"</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Success: </span><span class="sc">{</span>domains<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="issue-jina-api-validation-fails" class="level4">
<h4 class="anchored" data-anchor-id="issue-jina-api-validation-fails">Issue: Jina API Validation Fails</h4>
<p><strong>Symptoms</strong>: - All domains fail Jina validation - <code>active_domains</code> list is empty</p>
<p><strong>Possible Causes</strong>: 1. Invalid <code>JINA_API_KEY</code> 2. Jina API rate limiting 3. Domains are actually inactive/parked</p>
<p><strong>Solutions</strong>: - Verify <code>JINA_API_KEY</code> in environment variables - Check Jina API rate limits - Review <code>jina_results</code> to see error messages - Reduce concurrency limit in <code>check_jina_api</code> (default: 10)</p>
<p><strong>Debug Steps</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.clients.jina_client <span class="im">import</span> JinaClient</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lead_gen.configuration <span class="im">import</span> LeadGenConfiguration</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> LeadGenConfiguration()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Jina API Key set: </span><span class="sc">{</span><span class="bu">bool</span>(config.jina_api_key)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> JinaClient(api_key<span class="op">=</span>config.jina_api_key)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> <span class="cf">await</span> client.fetch_site_info(<span class="st">"example.com"</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Success: </span><span class="sc">{</span>JinaClient<span class="sc">.</span>is_success_response(response)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> JinaClient.is_success_response(response):</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>JinaClient<span class="sc">.</span>get_error_message(response)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="state-inspection" class="level3">
<h3 class="anchored" data-anchor-id="state-inspection">10.2 State Inspection</h3>
<p><strong>In LangGraph Studio</strong>: 1. Open workflow execution 2. Click on each node to inspect state 3. Check <code>leads</code> field at each step 4. Review <code>supervisor_messages</code> for research progress 5. Check <code>classification_output</code> for buyer personas</p>
<p><strong>Programmatic Inspection</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run workflow and inspect state</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>final_state <span class="op">=</span> <span class="cf">await</span> leadgen_researcher.ainvoke(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"domain_name"</span>: <span class="st">"example.com"</span>},</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    config</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check each field</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification:"</span>, final_state.get(<span class="st">"classification_output"</span>))</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Leads count:"</span>, <span class="bu">len</span>(final_state.get(<span class="st">"leads"</span>, [])))</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Notes count:"</span>, <span class="bu">len</span>(final_state.get(<span class="st">"notes"</span>, [])))</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect leads</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lead <span class="kw">in</span> final_state.get(<span class="st">"leads"</span>, []):</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Lead: </span><span class="sc">{</span>lead<span class="sc">.</span>website<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>lead<span class="sc">.</span>tier<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="performance-optimization" class="level3">
<h3 class="anchored" data-anchor-id="performance-optimization">10.3 Performance Optimization</h3>
<p><strong>Reduce Research Scope</strong>: - Lower <code>max_researcher_iterations</code> (default: 5) - Lower <code>max_react_tool_calls</code> (default: 4) - Lower <code>max_concurrent_research_units</code> (default: 5)</p>
<p><strong>Optimize DotDB Flow</strong>: - Limit <code>generated_keywords</code> (currently capped at 80) - Reduce Jina concurrency (currently 10)</p>
<p><strong>Model Selection</strong>: - Use faster models for classification (e.g., <code>gpt-4.1-mini</code>) - Use more capable models for research (e.g., <code>gpt-4.1</code>)</p>
</section>
<section id="logging" class="level3">
<h3 class="anchored" data-anchor-id="logging">10.4 Logging</h3>
<p>Enable debug logging to trace execution:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.DEBUG)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Log Points</strong>: - <code>[dotdb]</code> prefix: DotDB subgraph operations - <code>[jina_search]</code> prefix: Jina search operations - <code>[jina_reader]</code> prefix: Jina reader operations</p>
<hr>
</section>
</section>
<section id="appendix-code-reference-map" class="level2">
<h2 class="anchored" data-anchor-id="appendix-code-reference-map">Appendix: Code Reference Map</h2>
<section id="main-graph" class="level3">
<h3 class="anchored" data-anchor-id="main-graph">Main Graph</h3>
<ul>
<li><strong>Graph Definition</strong>: <code>src/lead_gen/agent.py:328-353</code></li>
<li><strong>Entry Point</strong>: <code>leadgen_researcher</code> (compiled graph)</li>
</ul>
</section>
<section id="nodes" class="level3">
<h3 class="anchored" data-anchor-id="nodes">Nodes</h3>
<ul>
<li><strong>classify_and_seed_supervisor</strong>: <code>src/lead_gen/agent.py:70-114</code></li>
<li><strong>research_supervisor</strong>: <code>src/open_deep_research/deep_researcher.py:377-389</code> (subgraph)</li>
<li><strong>dotdb_generate_leads</strong>: <code>src/lead_gen/agent.py:305-325</code></li>
<li><strong>dedupe_leads</strong>: <code>src/lead_gen/agent.py:168-232</code></li>
<li><strong>get_leads</strong>: <code>src/lead_gen/agent.py:235-302</code></li>
</ul>
</section>
<section id="dotdb-subgraph" class="level3">
<h3 class="anchored" data-anchor-id="dotdb-subgraph">DotDB Subgraph</h3>
<ul>
<li><strong>Graph Definition</strong>: <code>src/lead_gen/dotdb_subgraph.py:342-358</code></li>
<li><strong>generate_dotdb_keywords</strong>: <code>src/lead_gen/dotdb_subgraph.py:51-154</code></li>
<li><strong>fetch_dotdb_domains</strong>: <code>src/lead_gen/dotdb_subgraph.py:157-196</code></li>
<li><strong>check_jina_api</strong>: <code>src/lead_gen/dotdb_subgraph.py:199-252</code></li>
<li><strong>jina_results_to_leads</strong>: <code>src/lead_gen/dotdb_subgraph.py:255-339</code></li>
</ul>
</section>
<section id="supervisor-integration" class="level3">
<h3 class="anchored" data-anchor-id="supervisor-integration">Supervisor Integration</h3>
<ul>
<li><strong>Supervisor Subgraph</strong>: <code>src/open_deep_research/deep_researcher.py:377-389</code></li>
<li><strong>Supervisor Node</strong>: <code>src/open_deep_research/deep_researcher.py:186-233</code></li>
<li><strong>Supervisor Tools</strong>: <code>src/open_deep_research/deep_researcher.py:235-375</code></li>
<li><strong>Researcher Subgraph</strong>: <code>src/open_deep_research/deep_researcher.py:694-720</code></li>
<li><strong>Compress Research</strong>: <code>src/open_deep_research/deep_researcher.py:607-692</code></li>
<li><strong>Extract Leads</strong>: <code>src/open_deep_research/deep_researcher.py:539-604</code></li>
</ul>
</section>
<section id="data-models" class="level3">
<h3 class="anchored" data-anchor-id="data-models">Data Models</h3>
<ul>
<li><strong>LeadGenState</strong>: <code>src/lead_gen/agent.py:41-53</code></li>
<li><strong>Lead</strong>: <code>src/lead_gen/agent.py:56-63</code></li>
<li><strong>LeadList</strong>: <code>src/lead_gen/agent.py:66-67</code></li>
<li><strong>DotDBState</strong>: <code>src/lead_gen/dotdb_subgraph.py:27-35</code></li>
</ul>
</section>
<section id="prompts" class="level3">
<h3 class="anchored" data-anchor-id="prompts">Prompts</h3>
<ul>
<li><strong>Classification Prompt</strong>: <code>src/lead_gen/classify_prompts.py:3-43</code></li>
<li><strong>Classification Guide</strong>: <code>src/lead_gen/classify_prompts.py:46-99</code></li>
<li><strong>LeadGen Supervisor Prompt</strong>: <code>src/lead_gen/classify_prompts.py:102-162</code></li>
<li><strong>DotDB Keyword Generation Prompt</strong>: <code>src/lead_gen/classify_prompts.py:164-264</code></li>
</ul>
</section>
<section id="clients" class="level3">
<h3 class="anchored" data-anchor-id="clients">Clients</h3>
<ul>
<li><strong>DotDBClient</strong>: <code>src/lead_gen/clients/dotdb_client.py:5-99</code></li>
<li><strong>JinaClient</strong>: <code>src/lead_gen/clients/jina_client.py:44-133</code></li>
<li><strong>ScraperClient</strong>: <code>src/lead_gen/clients/scraping_client.py:5-25</code></li>
</ul>
</section>
<section id="configuration-1" class="level3">
<h3 class="anchored" data-anchor-id="configuration-1">Configuration</h3>
<ul>
<li><strong>LeadGenConfiguration</strong>: <code>src/lead_gen/configuration.py:7-11</code></li>
<li><strong>Configuration</strong> (main): <code>src/open_deep_research/configuration.py:39-257</code></li>
</ul>
</section>
<section id="utilities" class="level3">
<h3 class="anchored" data-anchor-id="utilities">Utilities</h3>
<ul>
<li><strong>normalize_website</strong>: <code>src/lead_gen/agent.py:117-165</code></li>
<li><strong>extract_sld</strong>: <code>src/lead_gen/dotdb_subgraph.py:45-48</code></li>
</ul>
<hr>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This guidebook provides a comprehensive overview of the LeadGen workflow, from domain classification to final lead generation. The workflow combines AI-powered web research with keyword-based domain matching to produce high-quality leads for domain brokerage.</p>
<section id="key-takeaways" class="level3">
<h3 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h3>
<ol type="1">
<li><strong>Dual Path Architecture</strong>: LeadGen uses two parallel paths (research supervisor and DotDB) to maximize lead discovery</li>
<li><strong>State Management</strong>: Careful use of reducers ensures proper state accumulation and override</li>
<li><strong>Deduplication</strong>: Two-stage deduplication ensures clean, unique leads</li>
<li><strong>Modularity</strong>: DotDB subgraph and supervisor subgraph are reusable components</li>
<li><strong>Extensibility</strong>: Easy to add new lead sources or modify extraction logic</li>
</ol>
</section>
<section id="next-steps" class="level3">
<h3 class="anchored" data-anchor-id="next-steps">Next Steps</h3>
<ul>
<li>Review the code references to understand implementation details</li>
<li>Experiment with different configurations to optimize for your use case</li>
<li>Monitor state transitions in LangGraph Studio for debugging</li>
<li>Extend the workflow with additional lead sources or validation steps</li>
</ul>
<p>For questions or contributions, refer to the main project documentation and codebase.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>